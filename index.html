<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistema de PDV e Controle de Estoque - Doce Jardim">
    <meta name="theme-color" content="#C8A8D8">
    <meta name="author" content="Doce Jardim">
    <meta name="keywords" content="pdv, estoque, vendas, controle">
    
    <title>Doce Jardim - Sistema PDV</title>

    <!-- MELHORIA: Otimiza√ß√£o de Conex√£o (preconnect) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://utykuriccvvhitlrdqcw.supabase.co">
    
    <!-- MELHORIA: Tags Open Graph para melhor compartilhamento -->
    <meta property="og:title" content="Doce Jardim - Sistema PDV">
    <meta property="og:description" content="Sistema moderno e eficiente para PDV e controle de estoque.">
    <meta property="og:image" content="./icons/icon-192x192.png">
    <meta property="og:url" content="#">
    <meta property="og:type" content="website">
    
    <!-- Fontes do Google -->
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&family=Comfortaa:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="css/styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" href="icons/icon-192x192.png">
</head>
<body>
    <!-- TELA DE LOGIN -->
    <div id="loginScreen" class="screen active">
        <main>
            <div class="login-container">
                <div class="login-header">
                    <h1>doce jardim</h1>
                    <p>Sistema de PDV e Estoque</p>
                </div>
                <div class="login-form">
                    <label for="loginUser" class="sr-only">Usu√°rio</label>
                    <input type="text" id="loginUser" placeholder="Usu√°rio" autocomplete="username">
                    
                    <label for="loginPass" class="sr-only">Senha</label>
                    <input type="password" id="loginPass" placeholder="Senha" autocomplete="current-password">
                    
                    <button onclick="app.login()" class="btn-primary">Entrar</button>
                </div>
            </div>
        </main>
    </div>

    <!-- TELA PRINCIPAL (DASHBOARD) -->
    <div id="dashboardScreen" class="screen">
        <header class="app-header">
            <h1>doce jardim</h1>
            <button onclick="app.logout()" class="btn-logout" aria-label="Sair do sistema">Sair</button>
        </header>

        <main>
            <div class="dashboard-container">
                <h2>Menu Principal</h2>
                
                <div class="dashboard-grid">
                    <div class="dashboard-card" onclick="app.showScreen('mesasScreen')" role="button" tabindex="0">
                        <div class="card-icon">ü™ë</div>
                        <h3>Mesas</h3>
                        <p>Gerenciar comandas</p>
                    </div>

                    <div class="dashboard-card" onclick="app.showScreen('pdvScreen')" role="button" tabindex="0">
                        <div class="card-icon">üí∞</div>
                        <h3>PDV Direto</h3>
                        <p>Venda r√°pida</p>
                    </div>

                    <div class="dashboard-card" onclick="app.showScreen('produtosScreen')" role="button" tabindex="0">
                        <div class="card-icon">üìù</div>
                        <h3>Produtos</h3>
                        <p>Cadastrar produtos</p>
                    </div>

                    <div class="dashboard-card" onclick="app.showScreen('estoqueScreen')" role="button" tabindex="0">
                        <div class="card-icon">üì¶</div>
                        <h3>Estoque</h3>
                        <p>Controle de estoque</p>
                    </div>

                    <div class="dashboard-card" onclick="app.showScreen('relatoriosScreen')" role="button" tabindex="0">
                        <div class="card-icon">üìä</div>
                        <h3>Relat√≥rios</h3>
                        <p>Vendas e estat√≠sticas</p>
                    </div>

                    <div class="dashboard-card" onclick="app.showScreen('usuariosScreen')" role="button" tabindex="0" id="cardUsuarios">
                        <div class="card-icon">üë•</div>
                        <h3>Usu√°rios</h3>
                        <p>Gerenciar usu√°rios</p>
                    </div>
                </div>

                <button id="installBtnDash" class="btn-install-dash hidden" onclick="app.installApp()">
                    üì± Instalar App no Celular
                </button>
            </div>
        </main>
    </div>

    <!-- TELA MESAS -->
    <div id="mesasScreen" class="screen">
        <header class="app-header">
            <button onclick="app.showScreen('dashboardScreen')" class="btn-back">‚Üê Voltar</button>
            <h1>ü™ë Gerenciamento de Mesas</h1>
        </header>

        <main>
            <div class="mesas-container">
                <div class="mesas-filtros">
                    <button onclick="app.filtrarMesas('todas')" class="btn-filtro active" id="filtroTodasMesas">Todas</button>
                    <button onclick="app.filtrarMesas('ocupadas')" class="btn-filtro" id="filtroOcupadas">Ocupadas</button>
                    <button onclick="app.filtrarMesas('livres')" class="btn-filtro" id="filtroLivres">Livres</button>
                </div>

                <div id="listaMesas" class="mesas-grid"></div>
            </div>
        </main>
    </div>

    <!-- TELA COMANDA DA MESA -->
    <div id="comandaScreen" class="screen">
        <header class="app-header">
            <button onclick="app.voltarParaMesas()" class="btn-back">‚Üê Voltar</button>
            <h1 id="comandaTitulo">üìã Mesa 1</h1>
        </header>

        <main>
            <div class="pdv-container">
                <!-- NOVA SE√á√ÉO DE PESQUISA E CATEGORIAS PARA MESAS -->
                <div class="search-section">
                   <input type="text" id="pesquisaMesas" placeholder="üîç Pesquisar produtos..." 
           oninput="app.pesquisarProdutosMesas()" class="pesquisa-produto mesas">
                </div>
                
                <div class="categorias-container">
                    <div id="categoriasMesas" class="categorias-buttons">
                        <!-- Categorias ser√£o inseridas aqui via JavaScript -->
                    </div>
                </div>

                <div class="pdv-produtos">
                    <h3>Adicionar Produtos</h3>
                    <div id="listaProdutosComanda" class="produtos-grid"></div>
                    
                    <!-- NOVA PAGINA√á√ÉO PARA MESAS -->
                    <div id="paginacaoMesas" class="paginacao" style="display: none;">
                        <!-- Bot√µes de pagina√ß√£o ser√£o inseridos aqui -->
                    </div>
                </div>

                <div class="pdv-carrinho">
                    <h3>Itens da Comanda</h3>
                    <div id="comandaItens" class="carrinho-lista">
                        <div class="empty-state">Comanda vazia</div>
                    </div>
                    
                    <div class="comanda-info">
                        <p><strong>Aberta em:</strong> <span id="comandaHorario">--:--</span></p>
                        <p><strong>Gar√ßom:</strong> <span id="comandaGarcom">Admin</span></p>
                    </div>

                    <div class="carrinho-total">
                        <h2>Total: R$ <span id="comandaTotal">0.00</span></h2>
                        
                        <button onclick="app.imprimirComanda()" class="btn-secondary">üñ®Ô∏è Imprimir Comanda</button>
                        <button onclick="app.finalizarComanda()" class="btn-primary btn-large">Fechar Conta</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- TELA PDV DIRETO -->
    <div id="pdvScreen" class="screen">
        <header class="app-header">
            <button onclick="app.showScreen('dashboardScreen')" class="btn-back">‚Üê Voltar</button>
            <h1>üí∞ PDV - Venda Direta</h1>
        </header>

        <main>
            <div class="pdv-container">
                <div class="pdv-produtos">
                    <h3>Produtos Dispon√≠veis</h3>
                    
                    <!-- CAMPO DE PESQUISA -->
                    <div class="search-section">
                        <input type="text" id="pesquisaPDV" placeholder="üîç Pesquisar produto..." 
               oninput="app.pesquisarProdutosPDV()" class="pesquisa-produto pdv">
                    </div>
                    
                    <!-- NOVAS CATEGORIAS COMPLETAS -->
                    <div class="categorias-container">
                        <div id="categoriasPDV" class="categorias-buttons">
                            <!-- Categorias ser√£o inseridas aqui via JavaScript -->
                        </div>
                    </div>
                    
                    <div id="listaProdutosPDV" class="produtos-grid">
                        <div class="loading">Carregando produtos...</div>
                    </div>
                    
                    <!-- NOVA PAGINA√á√ÉO PARA PDV -->
                    <div id="paginacaoPDV" class="paginacao" style="display: none;">
                        <!-- Bot√µes de pagina√ß√£o ser√£o inseridos aqui -->
                    </div>
                </div>

                <div class="pdv-carrinho">
                    <h3>Carrinho</h3>
                    <div id="carrinhoItens" class="carrinho-lista">
                        <div class="empty-state">Carrinho vazio</div>
                    </div>
                    
                    <div class="carrinho-desconto">
                        <label for="tipoDesconto">Desconto:</label>
                        <select id="tipoDesconto">
                            <option value="nenhum">Sem desconto</option>
                            <option value="percentual">% Percentual</option>
                            <option value="reais">R$ Reais</option>
                        </select>
                        <input type="number" id="valorDesconto" placeholder="0" min="0" step="0.01" style="display: none;" aria-label="Valor do desconto">
                    </div>

                    <div class="carrinho-total">
                        <div class="total-detalhes">
                            <p>Subtotal: R$ <span id="subtotalCarrinho">0.00</span></p>
                            <p class="desconto-aplicado" id="descontoAplicado" style="display: none;">Desconto: -R$ <span id="valorDescontoAplicado">0.00</span></p>
                            <h2>Total: R$ <span id="carrinhoTotal">0.00</span></h2>
                        </div>
                        
                        <!-- MELHORIA: Adicionando label expl√≠cito para acessibilidade -->
                        <div class="forma-pagamento">
                            <label for="formaPagamento">Forma de Pagamento:</label>
                            <select id="formaPagamento">
                                <option value="dinheiro">üíµ Dinheiro</option>
                                <option value="pix">üì± PIX</option>
                                <option value="credito">üí≥ Cart√£o Cr√©dito</option>
                                <option value="debito">üí≥ Cart√£o D√©bito</option>
                            </select>
                        </div>

                        <button onclick="app.finalizarVenda()" class="btn-primary btn-large">Finalizar Venda</button>
                        <button onclick="app.limparCarrinho()" class="btn-secondary">Limpar Carrinho</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- TELA PRODUTOS -->
    <div id="produtosScreen" class="screen">
        <header class="app-header">
            <button onclick="app.showScreen('dashboardScreen')" class="btn-back">‚Üê Voltar</button>
            <h1>üìù Cadastro de Produtos</h1>
        </header>

        <main>
            <div class="content-container">
                <div class="form-card">
                    <h3>Novo Produto</h3>
                    <label for="produtoNome" class="sr-only">Nome do produto</label>
                    <input type="text" id="produtoNome" placeholder="Nome do produto" required>
                    
                    <label for="produtoPreco" class="sr-only">Pre√ßo</label>
                    <input type="number" id="produtoPreco" placeholder="Pre√ßo (R$)" step="0.01" min="0" required>
                    
                    <label for="produtoEstoque" class="sr-only">Estoque</label>
                    <input type="number" id="produtoEstoque" placeholder="Quantidade em estoque" min="0" required>
                    
                    <label for="produtoCategoria" class="sr-only">Categoria</label>
                    <select id="produtoCategoria" required>
                        <option value="">Selecione a categoria</option>
                        <option value="lanches">ü•™ Lanches</option>
                        <option value="salgados">ü•ü Salgados</option>
                        <option value="bolos">üç∞ Bolos</option>
                        <option value="bebidas">ü•§ Bebidas</option>
                        <option value="sobremesa">üç® Sobremesas</option>
                        <option value="bomboniere">üç¨ Bomboniere</option>
                    </select>
                    
                    <button onclick="app.adicionarProduto()" class="btn-primary">Adicionar Produto</button>
                </div>

                <div class="lista-produtos">
                    <h3>Produtos Cadastrados</h3>
                    
                    <!-- CAMPO DE PESQUISA -->
                    <div class="search-section">
                        <input type="text" id="pesquisaProduto" placeholder="üîç Pesquisar produto..." 
               oninput="app.pesquisarProdutos()" class="pesquisa-produto">
                    </div>
                    
                    <div id="listaProdutos">
                        <div class="loading">Carregando produtos...</div>
                    </div>
                    
                    <!-- PAGINA√á√ÉO -->
                    <div class="paginacao" id="paginacaoProdutos" style="display: none;">
                        <button onclick="app.mudarPaginaProdutos('anterior')" class="btn-paginacao" id="btnAnteriorProdutos">
                            ‚Üê Anterior
                        </button>
                        
                        <span class="info-pagina" id="infoPaginaProdutos">
                            P√°gina 1 de 1
                        </span>
                        
                        <button onclick="app.mudarPaginaProdutos('proxima')" class="btn-paginacao" id="btnProximaProdutos">
                            Pr√≥xima ‚Üí
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- TELA ESTOQUE -->
    <div id="estoqueScreen" class="screen">
        <header class="app-header">
            <button onclick="app.showScreen('dashboardScreen')" class="btn-back">‚Üê Voltar</button>
            <h1>üì¶ Controle de Estoque</h1>
        </header>

        <main>
            <div class="content-container">
                <div id="listaEstoque">
                    <div class="loading">Carregando estoque...</div>
                </div>
            </div>
        </main>
    </div>

    <!-- TELA RELAT√ìRIOS -->
    <div id="relatoriosScreen" class="screen">
        <header class="app-header">
            <button onclick="app.showScreen('dashboardScreen')" class="btn-back">‚Üê Voltar</button>
            <h1>üìä Relat√≥rios de Vendas</h1>
        </header>

        <main>
            <div class="content-container">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Vendas Hoje</h3>
                        <p class="stat-value">R$ <span id="vendasHoje">0.00</span></p>
                    </div>
                    <div class="stat-card">
                        <h3>Total de Vendas</h3>
                        <p class="stat-value"><span id="totalVendas">0</span></p>
                    </div>
                    <div class="stat-card">
                        <h3>Produtos Vendidos</h3>
                        <p class="stat-value"><span id="produtosVendidos">0</span></p>
                    </div>
                    <div class="stat-card">
                        <h3>Ticket M√©dio</h3>
                        <p class="stat-value">R$ <span id="ticketMedio">0.00</span></p>
                    </div>
                </div>

                <div class="historico-vendas">
                    <h3>Hist√≥rico de Vendas</h3>
                    <div class="filtros-vendas">
                        <div class="filtros-buttons">
                            <button onclick="app.filtrarVendas('hoje')" class="btn-filtro active" id="filtroHoje">Hoje</button>
                            <button onclick="app.filtrarVendas('semana')" class="btn-filtro" id="filtroSemana">Esta Semana</button>
                            <button onclick="app.filtrarVendas('mes')" class="btn-filtro" id="filtroMes">Este M√™s</button>
                            <button onclick="app.filtrarVendas('todas')" class="btn-filtro" id="filtroTodas">Todas</button>
                            <div class="filtro-usuario">
                                <label for="filtroUsuario">Filtrar por usu√°rio:</label>
                                <select id="filtroUsuario" onchange="app.filtrarPorUsuario()">
                                    <option value="todos">Todos os usu√°rios</option>
                                </select>
                            </div>
                        </div>
                        <div class="filtro-periodo">
                            <label for="dataInicio">Per√≠odo personalizado:</label>
                            <input type="date" id="dataInicio" aria-label="Data inicial">
                            <input type="date" id="dataFim" aria-label="Data final">
                            <button onclick="app.filtrarPorPeriodo()" class="btn-filtro-custom">Buscar Per√≠odo</button>
                        </div>
                    </div>
                    <div id="historicoVendas">
                        <div class="loading">Carregando hist√≥rico...</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- TELA USU√ÅRIOS -->
    <div id="usuariosScreen" class="screen">
        <header class="app-header">
            <button onclick="app.showScreen('dashboardScreen')" class="btn-back">‚Üê Voltar</button>
            <h1>üë• Gerenciamento de Usu√°rios</h1>
        </header>

        <main>
            <div class="content-container">
                <div class="form-card">
                    <h3>Novo Usu√°rio</h3>
                    <label for="usuarioNome" class="sr-only">Nome do usu√°rio</label>
                    <input type="text" id="usuarioNome" placeholder="Nome completo" required>
                    
                    <label for="usuarioLogin" class="sr-only">Login</label>
                    <input type="text" id="usuarioLogin" placeholder="Login (usu√°rio)" required>
                    
                    <label for="usuarioSenha" class="sr-only">Senha</label>
                    <input type="password" id="usuarioSenha" placeholder="Senha" required>
                    
                    <label for="usuarioTipo" class="sr-only">Tipo de usu√°rio</label>
                    <select id="usuarioTipo" required>
                        <option value="">Selecione o tipo</option>
                        <option value="administrador">üëë Administrador</option>
                        <option value="normal">üë§ Usu√°rio Normal</option>
                    </select>
                    
                    <button onclick="app.adicionarUsuario()" class="btn-primary">Adicionar Usu√°rio</button>
                </div>

                <div class="lista-produtos">
                    <h3>Usu√°rios Cadastrados</h3>
                    
                    <div class="search-section">
                        <input type="text" id="pesquisaUsuario" placeholder="üîç Pesquisar usu√°rio..." 
                               oninput="app.pesquisarUsuarios()" class="search-input">
                    </div>
                    
                    <div id="listaUsuarios">
                        <div class="loading">Carregando usu√°rios...</div>
                    </div>
                    
                    <div class="paginacao" id="paginacaoUsuarios" style="display: none;">
                        <button onclick="app.mudarPaginaUsuarios('anterior')" class="btn-paginacao" id="btnAnteriorUsuarios">
                            ‚Üê Anterior
                        </button>
                        
                        <span class="info-pagina" id="infoPaginaUsuarios">
                            P√°gina 1 de 1
                        </span>
                        
                        <button onclick="app.mudarPaginaUsuarios('proxima')" class="btn-paginacao" id="btnProximaUsuarios">
                            Pr√≥xima ‚Üí
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- MODAL EDITAR PRODUTO -->
    <div id="modalEditarProduto" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="app.fecharModalEdicao()" aria-label="Fechar modal">√ó</span>
            <h3>Editar Produto</h3>
            
            <input type="hidden" id="editProdutoId">
            
            <label for="editProdutoNome" class="sr-only">Nome do produto</label>
            <input type="text" id="editProdutoNome" placeholder="Nome do produto" required>
            
            <label for="editProdutoPreco" class="sr-only">Pre√ßo</label>
            <input type="number" id="editProdutoPreco" placeholder="Pre√ßo (R$)" step="0.01" min="0" required>
            
            <label for="editProdutoEstoque" class="sr-only">Estoque</label>
            <input type="number" id="editProdutoEstoque" placeholder="Quantidade em estoque" min="0" required>
            
            <label for="editProdutoCategoria" class="sr-only">Categoria</label>
            <select id="editProdutoCategoria" required>
                <option value="">Selecione a categoria</option>
                <option value="lanches">ü•™ Lanches</option>
                <option value="salgados">ü•ü Salgados</option>
                <option value="bolos">üç∞ Bolos</option>
                <option value="bebidas">ü•§ Bebidas</option>
                <option value="sobremesa">üç® Sobremesas</option>
                <option value="bomboniere">üç¨ Bomboniere</option>
            </select>
            
            <button onclick="app.salvarEdicaoProduto()" class="btn-primary">Salvar Altera√ß√µes</button>
            <button onclick="app.fecharModalEdicao()" class="btn-secondary">Cancelar</button>
        </div>
    </div>

    <!-- MODAL EDITAR USU√ÅRIO -->
    <div id="modalEditarUsuario" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="app.fecharModalEdicaoUsuario()" aria-label="Fechar modal">√ó</span>
            <h3>Editar Usu√°rio</h3>
            
            <input type="hidden" id="editUsuarioId">
            
            <label for="editUsuarioNome" class="sr-only">Nome do usu√°rio</label>
            <input type="text" id="editUsuarioNome" placeholder="Nome completo" required>
            
            <label for="editUsuarioLogin" class="sr-only">Login</label>
            <input type="text" id="editUsuarioLogin" placeholder="Login (usu√°rio)" required>
            
            <label for="editUsuarioSenha" class="sr-only">Nova senha (deixe em branco para manter)</label>
            <input type="password" id="editUsuarioSenha" placeholder="Nova senha (deixe em branco para manter)">
            
            <label for="editUsuarioTipo" class="sr-only">Tipo de usu√°rio</label>
            <select id="editUsuarioTipo" required>
                <option value="administrador">üëë Administrador</option>
                <option value="normal">üë§ Usu√°rio Normal</option>
            </select>
            
            <button onclick="app.salvarEdicaoUsuario()" class="btn-primary">Salvar Altera√ß√µes</button>
            <button onclick="app.fecharModalEdicaoUsuario()" class="btn-secondary">Cancelar</button>
        </div>
    </div>

    <!-- MODAL FECHAR CONTA -->
    <div id="modalFecharConta" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="app.fecharModalConta()" aria-label="Fechar modal">√ó</span>
            <h3>üí≥ Fechar Conta - Mesa <span id="modalMesaNumero"></span></h3>
            
            <div class="modal-total">
                <h2>Total: R$ <span id="modalTotalConta">0.00</span></h2>
            </div>

            <div class="carrinho-desconto">
                <label for="modalTipoDesconto">Desconto:</label>
                <select id="modalTipoDesconto">
                    <option value="nenhum">Sem desconto</option>
                    <option value="percentual">% Percentual</option>
                    <option value="reais">R$ Reais</option>
                </select>
                <input type="number" id="modalValorDesconto" placeholder="0" min="0" step="0.01" style="display: none;">
            </div>

            <div class="total-detalhes" style="margin: 15px 0;">
                <p>Subtotal: R$ <span id="modalSubtotal">0.00</span></p>
                <p class="desconto-aplicado" id="modalDescontoAplicado" style="display: none;">Desconto: -R$ <span id="modalValorDescontoAplicado">0.00</span></p>
                <h3 style="color: #C8A8D8; margin-top: 10px;">Total Final: R$ <span id="modalTotalFinal">0.00</span></h3>
            </div>
            
            <!-- MELHORIA: Adicionando label expl√≠cito para acessibilidade -->
            <div class="forma-pagamento">
                <label for="modalFormaPagamento">Forma de Pagamento:</label>
                <select id="modalFormaPagamento">
                    <option value="dinheiro">üíµ Dinheiro</option>
                    <option value="pix">üì± PIX</option>
                    <option value="credito">üí≥ Cart√£o Cr√©dito</option>
                    <option value="debito">üí≥ Cart√£o D√©bito</option>
                </select>
            </div>
            
            <button onclick="app.confirmarFechamentoConta()" class="btn-primary btn-large">Confirmar Pagamento</button>
            <button onclick="app.fecharModalConta()" class="btn-secondary">Cancelar</button>
        </div>
    </div>

    <!-- MELHORIA: Container de notifica√ß√µes com aria-live para acessibilidade -->
    <div id="toastContainer" aria-live="polite" aria-atomic="true"></div>

    <!-- MELHORIA: Scripts movidos para o final do body para melhor performance -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="js/app.js"></script>
</body>
</html>

